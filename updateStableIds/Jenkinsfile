pipeline {
  agent any
    stages {
		stage('Setup: Rotate slice DBs'){
			steps{
				script{
					dir('updateStableIds'){
						withCredentials([usernamePassword(credentialsId: 'mySQLUsernamePassword', passwordVariable: 'pass', usernameVariable: 'user')]) {
							sh "mysql -u$user -p$pass -e \'drop database if exists slice_previous; create database slice_previous\'"
							sh "zcat  test_slice_69_snapshot.sql.gz 2>&1 | mysql -u$user -p$pass -hlocalhost slice_previous"
							sh "mysqldump -u$user -p$pass slice_test > test_slice_70_snapshot.sql"
							sh "gzip -f test_slice_70_snapshot.sql"
							sh "mysql -u$user -p$pass -e \'drop database if exists slice_current; create database slice_current\'"
							sh "zcat  test_slice_70_snapshot.sql.gz 2>&1 | mysql -u$user -p$pass -hlocalhost slice_current"
						}
					}
				}
			}
		}
        /*stage('Run') {
            steps {
              dir('updateStableIds') {
    	          sh 'mvn clean compile assembly:single'
                withCredentials([file(credentialsId: 'UpdateStableIdsConfig', variable: 'configFile')]) {
                  sh "java -jar target/updateStableIds-0.0.1-SNAPSHOT-jar-with-dependencies.jar \$configFile"
                }
              }
           }
        }*/
    }
}
